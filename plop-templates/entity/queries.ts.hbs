import { useQuery, type UseQueryOptions } from '@tanstack/react-query'
import { apiClient } from '@/shared/api'
import type { {{pascalCase name}} } from '@/entities/{{camelCase name}}/types'
import { {{camelCase name}}Keys } from './keys'

/**
 * Fetch {{camelCase name}} by ID
 */
async function fetch{{pascalCase name}}(id: string): Promise<{{pascalCase name}}> {
  const response = await apiClient.get<{{pascalCase name}}>(`/{{camelCase name}}s/${id}`)
  if (!response.data) {
    throw new Error('No {{camelCase name}} data returned')
  }
  return response.data
}

/**
 * Hook to get {{camelCase name}} by ID
 *
 * @example
 * const { data: {{camelCase name}}, isLoading } = use{{pascalCase name}}(id)
 */
export function use{{pascalCase name}}(
  id: string,
  options?: Omit<UseQueryOptions<{{pascalCase name}}>, 'queryKey' | 'queryFn'>,
) {
  return useQuery({
    queryKey: {{camelCase name}}Keys.detail(id),
    queryFn: () => fetch{{pascalCase name}}(id),
    enabled: Boolean(id),
    ...options,
  })
}

/**
 * Fetch all {{camelCase name}}s
 */
async function fetch{{pascalCase name}}s(): Promise<{{pascalCase name}}[]> {
  const response = await apiClient.get<{{pascalCase name}}[]>('/{{camelCase name}}s')
  if (!response.data) {
    throw new Error('No {{camelCase name}}s data returned')
  }
  return response.data
}

/**
 * Hook to get all {{camelCase name}}s
 *
 * @example
 * const { data: {{camelCase name}}s, isLoading } = use{{pascalCase name}}s()
 */
export function use{{pascalCase name}}s(
  options?: Omit<UseQueryOptions<{{pascalCase name}}[]>, 'queryKey' | 'queryFn'>,
) {
  return useQuery({
    queryKey: {{camelCase name}}Keys.lists(),
    queryFn: fetch{{pascalCase name}}s,
    ...options,
  })
}
